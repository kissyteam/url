//! Copyright 2015, kissy-url@1.0.4 MIT Licensed, build time: Thu, 02 Apr 2015 10:56:30 GMT 
modulex.add("url",["util","modulex-path"],function(e,t,a){function r(e){return":"===e.slice(-1)&&(e=e.slice(0,-1)),"http"===e||"https"===e||"ftp"===e||"gopher"===e||"file"===e}function o(e){return 1===e.length?"0"+e:e}function s(e,t){return encodeURI(e).replace(t,function(e){return"%"+o(e.charCodeAt(0).toString(16))})}function n(e,t){if(this instanceof n)return p.mix(this,d.parse(e,t)),this;throw new Error("Failed to construct 'URL': Please use the 'new' operator")}var h,p=e("util"),u=e("modulex-path"),i=/[#\/\?@]/g,l=/[#\?]/g,c=/#/g,m=new RegExp("^([\\w\\d+.-]+:)?(?://(?:([^/?#@]*)@)?([\\w\\d\\-\\u0100-\\uffff.+%]*|\\[[^\\]]+\\])(?::([0-9]+))?)?([^?#]+)?(\\?[^#]*)?(#.*)?$"),f={protocol:1,auth:2,hostname:3,port:4,pathname:5,search:6,hash:7},d={version:"1.0.4",parse:function(e,t){t&&(e=d.resolve("string"==typeof t?t:d.format(t),e));var a=e.match(m)||[],o={};for(var s in f)o[s]=a[f[s]]||"";o.protocol&&(o.protocol=o.protocol.toLowerCase()),o.hostname&&(o.hostname=o.hostname.toLowerCase());var n=o.protocol;if(n&&(o.slashes=-1!==e.lastIndexOf(n+"//")),n&&!r(n.slice(0,-1))){if(!o.slashes)return e=e.slice(0,n.length)+"//"+e.slice(n.length),o=d.parse(e),o.slashes=null,o}else o.hostname&&!o.pathname&&(o.pathname="/");if(o.host=o.hostname,o.port&&(o.host=o.hostname+":"+o.port),o.username="",o.password="",o.auth){var h=o.auth.split("@");o.username=h[0]||"",o.password=h[1]||""}return delete o.auth,o.href=d.format(o),o},format:function(e){var t=e.host;t===h&&e.hostname&&(t=encodeURIComponent(e.hostname),e.port&&(t+=":"+e.port));var a,o=e.search,n=e.hash||"",p=e.pathname||"",u=[];return(a=e.protocol)&&u.push(s(a,i)),t!==h&&((this.slashes||a&&r(a))&&u.push("//"),e.username&&(u.push(s([e.username,e.password||""].join(":"),i)),u.push("@")),u.push(t)),p&&u.push(s(p,l)),o&&u.push(o),n&&u.push("#"+s(n.substring(1),c)),u.join("")},resolve:function(e,t){var a,r=0,o=["protocol","auth","host","pathname","search","hash"],s={};e=d.parse(e),t=d.parse(t);for(var n=0;n<o.length;n++){var h=o[n];if(r)s[h]=t[h];else if(s[h]=e[h],"pathname"===h){var p=t.pathname;p&&(r=1,"/"!==p.charAt(0)&&(s.hostname&&!s.pathname?p="/"+p:s.pathname&&(("/."===p.slice(-2)||"/.."===p.slice(-3)||"."===p||".."===p)&&(p+="/"),a=s.pathname.lastIndexOf("/"),-1!==a&&(p=s.pathname.slice(0,a+1)+p))),s.pathname=u.normalize(p))}else"search"===h?t.search&&(s.search=t.search,r=1):t[h]&&(r=r||s[h]!==t[h],s[h]=t[h])}return d.format(s)}};n.prototype.toString=function(){return d.format(this)},n.resolve=d.resolve,n.stringify=d.format,a.exports=n});